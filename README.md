# IrairaBo_startmodule
スタートモジュール用のArduinoコード。

勝手に決めたこと（いろいろわかっていないところもあると思うので、誤りがあれば修正する）：  
・ソフトウェアシリアルのピン番号(RX, TX) → いくらでも変更可能  
・スレーブのアドレス指定（ゴールモジュールが0、それ以外はスタートモジュールに近い順に1,2,3...）  
・D-subの4番ピンの使い方：ゴールモジュールは、ゴールを検知したらHIGHにする。それ以外のモジュールはモジュールの出口を通過したらHIGHにする。  
・I2Cの使い方：スレーブは通過/ゴールを検知したときD-sub4番ピンをHIGHに、当たったことを検知したとき5番ピンをHIGHにするが、どのぐらいの時間HIGHにすれば良いかわからない。そこで、マスタ（スタートモジュール)は、HIGHを検知したらそのことをスレーブに通知し、スレーブは通知を受け取ったらLOWに戻す。  
・D-sub4番ピン、5番ピンのHIGH/LOWについての懸念とその対策：例えばスレーブ1、スレーブ2があったとして、スレーブ1は5番ピンをHIGHに、スレーブ2はLOWにしたとき（スレーブ1、2ともにpinModeをOUTPUTにしている）、挙動がどうなるかわからない。なので、現在通過中のスレーブのみpinModeをOUTPUTにし、それ以外のスレーブはINPUTにしている。なお、OUTPUTからINPUTに変更する前に必ずLOWにするようにする。

処理の流れ：  
①スタート待機状態  
PCにスタートメッセージ('s')を投げる。そのままPCから's'が帰ってきたら②に遷移する。  
②ゲーム進行状態  
・当たった判定用ピンがHIGHの場合：PCへ当たった判定メッセージ('h')を投げる。そのままPCから'h'が帰ってきたら、スレーブに当たった判定を検知したことを知らせる。  
・通過/ゴール判定用ピンがHIGHの場合：PCへ通過/ゴール判定メッセージ('t')を投げる。そのままPCから't'が帰ってきたら、スレーブに通過/ゴール判定を検知したことを知らせる。その後、通過/ゴール検知すべきスレーブを次のスレーブに切り替える。検知したスレーブがゴールモジュールだった場合、終了状態に遷移する。  
③終了状態  
PCに終了メッセージ('f')を投げる。そのままPCから'f'が帰ってくるのを待つ。その後何もしない。
